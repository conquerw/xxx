/* SPDX-License-Identifier: GPL-2.0-or-later */

#include <stdio.h>
#include <time.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>
#include <sys/time.h>
#include "xxhash.h"

static struct timeval start, end;
static unsigned long long total_us;

static void start_record_time(void)
{
	total_us = 0;
	gettimeofday(&start, NULL);
}

static void end_record_time(void)
{
	gettimeofday(&end, NULL);
	total_us = (end.tv_sec - start.tv_sec) * 1000 * 1000 + (end.tv_usec - start.tv_usec);
}

int main(int argc, char *argv[])
{
	const char *key = "B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112";

	XXH128_hash_t XXH128_hash = XXH3_128bits(key, (int)strlen(key));
	printf("%lx %lx\n", XXH128_hash.low64, XXH128_hash.high64);

	// XXH3_128bits
	start_record_time();

	unsigned long long loop_num = 1000000000;
	for(unsigned long long i = 0; i < loop_num; i++)
		XXH128_hash = XXH3_128bits(key, (int)strlen(key));

	end_record_time();
	
	float speed = ((float)loop_num) / ((float)total_us / 1000000);
	printf("loop_num=%lld, total_ms:%.6fms, speed:%.2ft/s\n",loop_num, (float)total_us / 1000, speed);

	// XXH3_64bits
	XXH64_hash_t XXH64_hash = XXH3_64bits(key, (int)strlen(key));
	printf("%lx\n", XXH64_hash);

	start_record_time();

	loop_num = 5000000000000000000;
	for(unsigned long long i = 0; i < loop_num; i++)
		XXH64_hash = XXH3_64bits(key, (int)strlen(key));

	end_record_time();
	
	speed = ((float)loop_num) / ((float)total_us / 1000000);
	printf("loop_num=%lld, total_ms:%.6fms, speed:%.2ft/s\n",loop_num, (float)total_us / 1000, speed);

	// XXH32
	XXH32_hash_t XXH32_hash = XXH32(key, (int)strlen(key), 0);
	printf("%x\n", XXH32_hash);

	start_record_time();

	loop_num = 5000000000000000000;
	for(unsigned long long i = 0; i < loop_num; i++)
		XXH32_hash = XXH32(key, (int)strlen(key), 0);

	end_record_time();

	speed = ((float)loop_num) / ((float)total_us / 1000000);
	printf("loop_num=%lld, total_ms:%.6fms, speed:%.2ft/s\n",loop_num, (float)total_us / 1000, speed);
   
   return 1;
}
