/* SPDX-License-Identifier: GPL-2.0-or-later */

#include <stdio.h>
#include <time.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>
#include <sys/time.h>
#include "murmur_hash3.h"

static struct timeval start, end;
static unsigned long long total_us;

static void start_record_time(void)
{
	total_us = 0;
	gettimeofday(&start, NULL);
}

static void end_record_time(void)
{
	gettimeofday(&end, NULL);
	total_us = (end.tv_sec-start.tv_sec)*1000*1000 + (end.tv_usec-start.tv_usec);
}

int main(int argc, char *argv[])
{
	unsigned long long hash_otpt[2];
	const char *key = "B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112B101010000112";
	murmur_hash3_x64_128(key, (int)strlen(key), 1, hash_otpt);
	printf("%llx %llx\n", hash_otpt[0], hash_otpt[1]);
	
	memset(hash_otpt, 0x00, sizeof(hash_otpt));
	murmur_hash3_x86_128(key, (int)strlen(key), 1, hash_otpt);
	printf("%llx %llx\n", hash_otpt[0], hash_otpt[1]);
	
	unsigned int test_out;
	murmur_hash3_x86_32(key, (int)strlen(key), 1, &test_out);
	printf("%x\n", test_out);
	
	start_record_time();

	int loop_num = 1000000;
	for(int i = 0; i < loop_num; i++)
		murmur_hash3_x86_32(key, (int)strlen(key), 1, &test_out);

	end_record_time();
	
	float speed = ((float)loop_num) / ((float)total_us / 1000000);
	printf("loop_num=%d, total_ms:%.6fms, speed:%.2ft/s\n",loop_num, (float)total_us / 1000, speed);
   
   return 1;
}
